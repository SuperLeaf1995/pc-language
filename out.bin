[section .text]

_restart:
call os_print_new_line
mov bx, _BF_PROMPT
call os_print_string
call _null_bf_buffer
call _null_bf_output
xor ax, ax
mov di, _BF_BUFFER
push ax
push di
call os_keystroke_echo
cmp ah, [KEY_ENTER]
je _output
cmp ah, [KEY_ESC]
je _exit
cmp al, '+'
je _add
cmp al, '-'
je _sub
cmp al, '>'
je _pointer_right
cmp al, '<'
je _pointer_left
cmp al, 'routine '
je _post
jmp _get_input
pop di
pop ax
inc ax
mov byte [routine BF_BUFFER], al
stosb
push ax
push di
jmp _get_input
pop di
pop ax
dec ax
mov byte [routine BF_BUFFER], al
stosb
push ax
push di
jmp _get_input
pop di
pop ax
dec di
mov byte [routine BF_BUFFER], al
stosb
push ax
push di
jmp _get_input
pop di
pop ax
inc di
mov byte [routine BF_BUFFER], al
stosb
push ax
push di
jmp _get_input
pop di
pop ax
mov di, _BF_OUTPUT
mov byte [routine BF_OUTPUT], _BF_BUFFER
stosb
push ax
push di
jmp _get_input
pop di
pop ax
call os_print_new_line
mov bx, _BF_OUTPUT
call os_print_string
jmp _restart
call os_command_finish
hlt
_null_bf_buffer:
xor di, di
mov di, _BF_BUFFER
mov si, 5000
cmp si, 0
je _null_bf_buffer_done
mov al, 0
stosb
dec si
jmp _null_bf_buffer_loop
ret
_null_bf_output:
xor di, di
mov di, _BF_OUTPUT
mov si, 5000
cmp si, 0
je _null_bf_output_done
mov al, 0
stosb
dec si
jmp _null_bf_output_loop
ret
_BF_HEADER db 'Brainfuck interpreter for AtieDOS', 0
_BF_COPYRIGHT db 'Copyright [c] 2020 AtieSoftwareroutine  All rights reserved', 0
_BF_PROMPT db '- ', 0
_BF_BUFFER times 8192 db 0
_BF_OUTPUT times 256 db 0
